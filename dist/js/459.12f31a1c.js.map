{"version":3,"file":"js/459.12f31a1c.js","mappings":"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","sources":["webpack://saltmate-app/./src/components/admin/TokenManagement.vue","webpack://saltmate-app/./src/components/admin/TokenManagement.vue?1a6e"],"sourcesContent":["<template>\n  <div class=\"management-container\">\n    <h3><i class=\"fas fa-coins\"></i> 토큰 관리 (COBS, BND)</h3>\n    <p>토큰의 발행, 소각 및 유통 현황을 관리합니다.</p>\n\n    <div class=\"token-summary card\">\n      <h4>토큰 현황</h4>\n      <div v-if=\"loading\" class=\"loading-spinner\"></div>\n      <div v-else class=\"summary-grid\">\n        <div class=\"token-card cobs\">\n          <h5>COBS (보상 토큰)</h5>\n          <p>총 발행량: {{ formatNumber(tokenData.cobs.totalSupply) }}</p>\n          <p>총 소각량: {{ formatNumber(tokenData.cobs.totalBurned) }}</p>\n          <p>\n            현재 유통량: {{ formatNumber(tokenData.cobs.circulatingSupply) }}\n          </p>\n        </div>\n        <div class=\"token-card bnd\">\n          <h5>BND (증권형 토큰)</h5>\n          <p>총 발행량: {{ formatNumber(tokenData.bnd.totalSupply) }}</p>\n          <p>총 소각량: {{ formatNumber(tokenData.bnd.totalBurned) }}</p>\n          <p>\n            현재 유통량: {{ formatNumber(tokenData.bnd.circulatingSupply) }}\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"token-actions card\">\n      <h4>토큰 발행 / 소각</h4>\n      <form @submit.prevent=\"handleAction\">\n        <div class=\"form-group-inline\">\n          <div class=\"form-group\">\n            <label>토큰 선택</label>\n            <select v-model=\"action.token\">\n              <option value=\"cobs\">COBS</option>\n              <option value=\"bnd\">BND</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label>작업 선택</label>\n            <select v-model=\"action.type\">\n              <option value=\"mint\">발행 (Mint)</option>\n              <option value=\"burn\">소각 (Burn)</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"amount\">수량</label>\n            <input\n              type=\"number\"\n              id=\"amount\"\n              v-model.number=\"action.amount\"\n              placeholder=\"수량 입력\"\n              min=\"0\"\n              required\n            />\n          </div>\n        </div>\n        <div class=\"form-group\">\n          <label for=\"reason\">사유</label>\n          <input\n            type=\"text\"\n            id=\"reason\"\n            v-model=\"action.reason\"\n            placeholder=\"발행 또는 소각 사유 (예: 이벤트 보상)\"\n            required\n          />\n        </div>\n        <button type=\"submit\" class=\"btn btn-primary\">작업 실행</button>\n      </form>\n    </div>\n\n    <div class=\"transaction-log card\">\n      <h4>트랜잭션 기록</h4>\n      <p class=\"placeholder-text\">이곳에 토큰 발행/소각 기록이 표시됩니다.</p>\n    </div>\n  </div>\n</template>\n\n<script setup>\n// 변경 후 (2개의 import 라인)\nimport { ref, reactive, onMounted } from \"vue\";\nimport { db, auth } from \"@/firebaseConfig\"; // auth 추가\nimport {\n  doc,\n  getDoc,\n  collection, // collection 추가\n  increment,\n  serverTimestamp,\n  writeBatch,\n} from \"firebase/firestore\"; // updateDoc 삭제\n\nconst loading = ref(true);\nconst tokenData = reactive({\n  cobs: { totalSupply: 0, totalBurned: 0, circulatingSupply: 0 },\n  bnd: { totalSupply: 0, totalBurned: 0, circulatingSupply: 0 },\n});\nconst action = reactive({\n  token: \"cobs\",\n  type: \"mint\",\n  amount: 0,\n  reason: \"\",\n});\n\n// --- Helper Functions ---\nconst formatNumber = (value) =>\n  new Intl.NumberFormat(\"ko-KR\").format(value || 0);\n\n// --- Firestore Functions ---\nconst fetchTokenData = async () => {\n  loading.value = true;\n  try {\n    const tokenDocRef = doc(db, \"tokenStats\", \"summary\");\n    const docSnap = await getDoc(tokenDocRef);\n    if (docSnap.exists()) {\n      const data = docSnap.data();\n      Object.assign(tokenData.cobs, data.cobs);\n      Object.assign(tokenData.bnd, data.bnd);\n    } else {\n      // 문서가 없으면 초기화\n      console.log(\"토큰 요약 문서가 존재하지 않아 초기화합니다.\");\n    }\n  } catch (error) {\n    console.error(\"토큰 데이터를 불러오는 중 오류 발생:\", error);\n  } finally {\n    loading.value = false;\n  }\n};\n\nconst handleAction = async () => {\n  if (action.amount <= 0 || !action.reason.trim()) {\n    alert(\"유효한 수량과 사유를 입력해주세요.\");\n    return;\n  }\n\n  const tokenName = action.token.toUpperCase();\n  const actionTypeText = action.type === \"mint\" ? \"발행\" : \"소각\";\n\n  if (\n    !confirm(\n      `${tokenName} 토큰 ${action.amount}개를 ${actionTypeText}하시겠습니까?`\n    )\n  )\n    return;\n\n  const batch = writeBatch(db);\n  const tokenSummaryRef = doc(db, \"tokenStats\", \"summary\");\n  const logRef = doc(collection(db, \"tokenTransactions\")); // 새 로그 문서\n\n  let updatePayload = {};\n\n  if (action.type === \"mint\") {\n    updatePayload[`${action.token}.totalSupply`] = increment(action.amount);\n    updatePayload[`${action.token}.circulatingSupply`] = increment(\n      action.amount\n    );\n  } else {\n    // burn\n    if (tokenData[action.token].circulatingSupply < action.amount) {\n      alert(\"소각하려는 수량이 현재 유통량보다 많습니다.\");\n      return;\n    }\n    updatePayload[`${action.token}.totalBurned`] = increment(action.amount);\n    updatePayload[`${action.token}.circulatingSupply`] = increment(\n      -action.amount\n    );\n  }\n\n  // 1. 요약 정보 업데이트\n  batch.update(tokenSummaryRef, updatePayload);\n\n  // 2. 트랜잭션 로그 기록\n  batch.set(logRef, {\n    token: action.token,\n    type: action.type,\n    amount: action.amount,\n    reason: action.reason,\n    createdAt: serverTimestamp(),\n    adminId: auth.currentUser.uid, // 실행한 관리자 ID 기록\n  });\n\n  try {\n    await batch.commit();\n    alert(`작업이 성공적으로 완료되었습니다.`);\n    action.amount = 0;\n    action.reason = \"\";\n    await fetchTokenData(); // 데이터 새로고침\n  } catch (error) {\n    console.error(\"토큰 작업 중 오류 발생:\", error);\n    alert(\"작업에 실패했습니다.\");\n  }\n};\n\nonMounted(fetchTokenData);\n</script>\n\n<style scoped>\n.management-container {\n  display: flex;\n  flex-direction: column;\n  gap: 30px;\n}\n.card {\n  background-color: #fff;\n  padding: 30px;\n  border-radius: 12px;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);\n}\nh3,\nh4,\nh5 {\n  margin-top: 0;\n}\n\n/* 토큰 요약 */\n.summary-grid {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 20px;\n}\n.token-card {\n  padding: 20px;\n  border-radius: 8px;\n  color: white;\n}\n.token-card h5 {\n  border-bottom: 1px solid rgba(255, 255, 255, 0.5);\n  padding-bottom: 10px;\n  margin-bottom: 15px;\n}\n.token-card p {\n  font-size: 1.1em;\n}\n.cobs {\n  background: linear-gradient(135deg, #2980b9, #3498db);\n}\n.bnd {\n  background: linear-gradient(135deg, #8e44ad, #9b59b6);\n}\n\n/* 토큰 작업 폼 */\n.token-actions .form-group-inline {\n  display: flex;\n  gap: 20px;\n  margin-bottom: 20px;\n}\n.token-actions .form-group {\n  flex: 1;\n}\n.token-actions label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 600;\n}\n.token-actions input,\n.token-actions select {\n  width: 100%;\n  padding: 10px;\n  border: 1px solid #ddd;\n  border-radius: 5px;\n  box-sizing: border-box;\n}\n.placeholder-text {\n  color: #999;\n  text-align: center;\n  padding: 20px;\n}\n\n/* 공용 스타일 */\n.btn-primary {\n  background-color: #007bff;\n  color: white;\n  border: none;\n  padding: 10px 20px;\n  border-radius: 5px;\n  cursor: pointer;\n}\n.loading-spinner {\n  /* ... 이전과 동일 ... */\n}\n</style>\n","import script from \"./TokenManagement.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./TokenManagement.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./TokenManagement.vue?vue&type=style&index=0&id=6ffc4054&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6ffc4054\"]])\n\nexport default __exports__"],"names":["loading","ref","tokenData","reactive","cobs","totalSupply","totalBurned","circulatingSupply","bnd","action","token","type","amount","reason","formatNumber","value","Intl","NumberFormat","format","fetchTokenData","async","tokenDocRef","doc","db","docSnap","getDoc","exists","data","Object","assign","console","log","error","handleAction","trim","alert","tokenName","toUpperCase","actionTypeText","confirm","batch","writeBatch","tokenSummaryRef","logRef","collection","updatePayload","increment","update","set","createdAt","serverTimestamp","adminId","auth","currentUser","uid","commit","onMounted","_createElementBlock","_hoisted_1","_createElementVNode","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_hoisted_6","_hoisted_7","onSubmit","_withModifiers","_hoisted_8","_hoisted_9","$event","_hoisted_10","_hoisted_11","for","id","placeholder","min","required","number","_hoisted_12","__exports__"],"sourceRoot":""}